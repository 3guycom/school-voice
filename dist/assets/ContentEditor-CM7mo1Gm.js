import{r as u,j as t,u as D,b as k}from"./index-JDxZcwZg.js";import{u as I}from"./schoolStore-DTX-YYhl.js";import{A as L}from"./arrow-left-WdqU8LdV.js";import{S as T}from"./save-0oS6DNbd.js";import{C as q}from"./circle-alert-B391DCOR.js";import"./createLucideIcon-YQMw5vR1.js";var y=Object.defineProperty,F=Object.getOwnPropertyDescriptor,U=Object.getOwnPropertyNames,A=Object.prototype.hasOwnProperty,R=(e,r)=>{for(var s in r)y(e,s,{get:r[s],enumerable:!0})},G=(e,r,s,o)=>{if(r&&typeof r=="object"||typeof r=="function")for(let n of U(r))!A.call(e,n)&&n!==s&&y(e,n,{get:()=>r[n],enumerable:!(o=F(r,n))||o.enumerable});return e},M=e=>G(y({},"__esModule",{value:!0}),e),B=(e,r,s)=>new Promise((o,n)=>{var m=i=>{try{d(s.next(i))}catch(c){n(c)}},x=i=>{try{d(s.throw(i))}catch(c){n(c)}},d=i=>i.done?o(i.value):Promise.resolve(i.value).then(m,x);d((s=s.apply(e,r)).next())}),N={};R(N,{SessionContextProvider:()=>K,useSession:()=>Q,useSessionContext:()=>W,useSupabaseClient:()=>z,useUser:()=>V});var H=M(N),l=u,J=t,g=(0,l.createContext)({isLoading:!0,session:null,error:null,supabaseClient:{}}),K=({supabaseClient:e,initialSession:r=null,children:s})=>{const[o,n]=(0,l.useState)(r),[m,x]=(0,l.useState)(!r),[d,i]=(0,l.useState)();(0,l.useEffect)(()=>{!o&&r&&n(r)},[o,r]),(0,l.useEffect)(()=>{let h=!0;function f(){return B(this,null,function*(){const{data:{session:v},error:b}=yield e.auth.getSession();if(h){if(b){i(b),x(!1);return}n(v),x(!1)}})}return f(),()=>{h=!1}},[]),(0,l.useEffect)(()=>{const{data:{subscription:h}}=e.auth.onAuthStateChange((f,v)=>{v&&(f==="SIGNED_IN"||f==="TOKEN_REFRESHED"||f==="USER_UPDATED")&&n(v),f==="SIGNED_OUT"&&n(null)});return()=>{h.unsubscribe()}},[]);const c=(0,l.useMemo)(()=>m?{isLoading:!0,session:null,error:null,supabaseClient:e}:d?{isLoading:!1,session:null,error:d,supabaseClient:e}:{isLoading:!1,session:o,error:null,supabaseClient:e},[m,o,d]);return(0,J.jsx)(g.Provider,{value:c,children:s})},W=()=>{const e=(0,l.useContext)(g);if(e===void 0)throw new Error("useSessionContext must be used within a SessionContextProvider.");return e};function z(){const e=(0,l.useContext)(g);if(e===void 0)throw new Error("useSupabaseClient must be used within a SessionContextProvider.");return e.supabaseClient}var Q=()=>{const e=(0,l.useContext)(g);if(e===void 0)throw new Error("useSession must be used within a SessionContextProvider.");return e.session},V=()=>{var e,r;const s=(0,l.useContext)(g);if(s===void 0)throw new Error("useUser must be used within a SessionContextProvider.");return(r=(e=s.session)==null?void 0:e.user)!=null?r:null};const re=()=>{const{draftId:e}=D(),r=k(),s=H.useSupabaseClient(),{currentSchool:o}=I(),[n,m]=u.useState(""),[x,d]=u.useState(""),[i,c]=u.useState(null),[h,f]=u.useState([]),[v,b]=u.useState(!0),[w,_]=u.useState(!1),[j,S]=u.useState(null);u.useEffect(()=>{(async()=>{if(!(!e||!o)){b(!0),S(null);try{const{data:p,error:C}=await s.from("content_drafts").select("*").eq("id",e).eq("school_id",o.id).single();if(C)throw C;p&&(m(p.title),d(p.content),c(p.tone_profile_id));const{data:O,error:P}=await s.from("tone_profiles").select("id, name").eq("school_id",o.id).eq("is_active",!0);if(P)throw P;f(O||[])}catch(p){console.error("Error fetching draft:",p),S("Failed to load content draft. Please try again later.")}finally{b(!1)}}})()},[e,o,s]);const E=async()=>{if(!(!e||!o)){_(!0),S(null);try{const{error:a}=await s.from("content_drafts").update({title:n,content:x,tone_profile_id:i,updated_at:new Date().toISOString()}).eq("id",e).eq("school_id",o.id);if(a)throw a}catch(a){console.error("Error saving draft:",a),S("Failed to save content draft. Please try again later.")}finally{_(!1)}}};return v?t.jsx("div",{className:"flex items-center justify-center min-h-screen",children:t.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-indigo-600"})}):t.jsxs("div",{className:"container mx-auto px-4 py-8",children:[t.jsxs("div",{className:"flex items-center justify-between mb-6",children:[t.jsxs("button",{onClick:()=>r(-1),className:"flex items-center text-gray-600 hover:text-gray-900",children:[t.jsx(L,{className:"w-5 h-5 mr-2"}),"Back"]}),t.jsxs("button",{onClick:E,disabled:w,className:"flex items-center px-4 py-2 bg-indigo-600 text-white rounded-md hover:bg-indigo-700 disabled:opacity-50",children:[w?t.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-t-2 border-b-2 border-white mr-2"}):t.jsx(T,{className:"w-4 h-4 mr-2"}),"Save"]})]}),j&&t.jsxs("div",{className:"mb-6 bg-red-50 border border-red-200 text-red-700 px-4 py-3 rounded-md flex items-start",children:[t.jsx(q,{className:"w-5 h-5 mr-2 mt-0.5 flex-shrink-0"}),t.jsx("span",{children:j})]}),t.jsxs("div",{className:"mb-6",children:[t.jsx("label",{htmlFor:"title",className:"block text-sm font-medium text-gray-700 mb-1",children:"Title"}),t.jsx("input",{id:"title",type:"text",value:n,onChange:a=>m(a.target.value),className:"w-full px-4 py-2 border border-gray-300 rounded-md focus:ring-indigo-500 focus:border-indigo-500",placeholder:"Enter title"})]}),t.jsxs("div",{className:"mb-6",children:[t.jsx("label",{htmlFor:"toneProfile",className:"block text-sm font-medium text-gray-700 mb-1",children:"Tone Profile"}),t.jsxs("select",{id:"toneProfile",value:i||"",onChange:a=>c(a.target.value||null),className:"w-full px-4 py-2 border border-gray-300 rounded-md focus:ring-indigo-500 focus:border-indigo-500",children:[t.jsx("option",{value:"",children:"Select a tone profile"}),h.map(a=>t.jsx("option",{value:a.id,children:a.name},a.id))]})]}),t.jsxs("div",{className:"mb-6",children:[t.jsx("label",{htmlFor:"content",className:"block text-sm font-medium text-gray-700 mb-1",children:"Content"}),t.jsx("textarea",{id:"content",value:x,onChange:a=>d(a.target.value),rows:12,className:"w-full px-4 py-2 border border-gray-300 rounded-md focus:ring-indigo-500 focus:border-indigo-500",placeholder:"Write your content here..."})]})]})};export{re as default};
