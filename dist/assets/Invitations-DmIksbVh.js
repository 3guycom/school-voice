import{u as _,a as C,r as o,j as e,s as h}from"./index-JDxZcwZg.js";import{M as v}from"./mail-CUcBglu-.js";import{R as A}from"./refresh-cw-dA3CF3FU.js";import{P as F}from"./plus-BRi9IV7e.js";import{C as P}from"./circle-check-big-BsFOWjj3.js";import{C as S}from"./clock-E4RsjpSd.js";import{T}from"./trash-2-Y6MaHXoy.js";import"./createLucideIcon-YQMw5vR1.js";let x;const V=new Uint8Array(16);function M(){if(!x&&(x=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!x))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return x(V)}const a=[];for(let t=0;t<256;++t)a.push((t+256).toString(16).slice(1));function H(t,r=0){return a[t[r+0]]+a[t[r+1]]+a[t[r+2]]+a[t[r+3]]+"-"+a[t[r+4]]+a[t[r+5]]+"-"+a[t[r+6]]+a[t[r+7]]+"-"+a[t[r+8]]+a[t[r+9]]+"-"+a[t[r+10]]+a[t[r+11]]+a[t[r+12]]+a[t[r+13]]+a[t[r+14]]+a[t[r+15]]}const L=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),I={randomUUID:L};function q(t,r,c){if(I.randomUUID&&!r&&!t)return I.randomUUID();t=t||{};const n=t.random||(t.rng||M)();return n[6]=n[6]&15|64,n[8]=n[8]&63|128,H(n)}const W=()=>{const{schoolId:t}=_(),{user:r}=C(),[c,n]=o.useState([]),[k,u]=o.useState(!0),[d,g]=o.useState(""),[y,D]=o.useState("member"),[f,w]=o.useState(!1),[j,m]=o.useState("");o.useEffect(()=>{if(!t)return;(async()=>{u(!0);try{const{data:i,error:l}=await h.rpc("get_school_invitations",{p_school_id:t});if(l)throw l;n(i)}catch(i){console.error("Error fetching invitations:",i)}finally{u(!1)}})()},[t]);const E=async s=>{if(s.preventDefault(),!d||!d.includes("@")){m("Please enter a valid email address");return}if(!(!t||!r)){w(!0),m("");try{const i=new Date;i.setDate(i.getDate()+7);const l=q(),{data:N,error:p}=await h.from("invitations").insert([{school_id:t,email:d.toLowerCase(),role:y,token:l,expires_at:i.toISOString(),created_by:r.id}]).select();if(p)if(p.code==="23505")m("An invitation for this email already exists");else throw p;else N&&(n([N[0],...c]),g(""))}catch(i){console.error("Error creating invitation:",i),m("Failed to create invitation. Please try again.")}finally{w(!1)}}},R=async s=>{if(window.confirm("Are you sure you want to revoke this invitation?"))try{const{error:i}=await h.from("invitations").delete().eq("id",s);if(i)throw i;n(c.filter(l=>l.id!==s))}catch(i){console.error("Error deleting invitation:",i)}},b=s=>{const i=new Date(s);return new Intl.DateTimeFormat("en-US",{month:"short",day:"numeric",year:"numeric",hour:"2-digit",minute:"2-digit"}).format(i)},U=s=>new Date(s)<new Date;return e.jsxs("div",{className:"container mx-auto px-4 py-8",children:[e.jsxs("div",{className:"mb-8",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-800 mb-4",children:"Invitations"}),e.jsx("p",{className:"text-gray-600",children:"Invite new members to join your school."})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-md p-6 mb-8",children:[e.jsx("h2",{className:"text-lg font-semibold mb-4",children:"New Invitation"}),e.jsxs("form",{onSubmit:E,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"email",className:"block text-sm font-medium text-gray-700 mb-1",children:"Email Address"}),e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:e.jsx(v,{className:"h-5 w-5 text-gray-400"})}),e.jsx("input",{type:"email",id:"email",value:d,onChange:s=>g(s.target.value),className:"pl-10 block w-full border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm",placeholder:"email@example.com"})]})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"role",className:"block text-sm font-medium text-gray-700 mb-1",children:"Role"}),e.jsxs("select",{id:"role",value:y,onChange:s=>D(s.target.value),className:"block w-full border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm",children:[e.jsx("option",{value:"member",children:"Member"}),e.jsx("option",{value:"admin",children:"Admin"})]})]}),j&&e.jsx("div",{className:"text-red-600 text-sm",children:j}),e.jsx("button",{type:"submit",disabled:f,className:"inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md shadow-sm text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 disabled:bg-indigo-400 disabled:cursor-not-allowed",children:f?e.jsxs(e.Fragment,{children:[e.jsx(A,{className:"animate-spin -ml-1 mr-2 h-4 w-4"}),"Sending..."]}):e.jsxs(e.Fragment,{children:[e.jsx(F,{className:"-ml-1 mr-2 h-4 w-4"}),"Send Invitation"]})})]})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-md overflow-hidden",children:[e.jsx("h2",{className:"text-lg font-semibold p-6 border-b",children:"Invitation History"}),k?e.jsx("div",{className:"flex justify-center items-center py-8",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-t-2 border-b-2 border-indigo-600"})}):c.length===0?e.jsx("div",{className:"text-center py-8 text-gray-500",children:"No invitations found"}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Email"}),e.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Role"}),e.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Status"}),e.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Sent"}),e.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Expires"}),e.jsx("th",{scope:"col",className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Actions"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:c.map(s=>e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(v,{className:"h-4 w-4 text-gray-400 mr-2"}),s.email]})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:e.jsx("span",{className:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${s.role==="admin"?"bg-purple-100 text-purple-800":"bg-green-100 text-green-800"}`,children:s.role})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm",children:s.accepted_at?e.jsxs("span",{className:"inline-flex items-center text-green-600",children:[e.jsx(P,{className:"h-4 w-4 mr-1"}),"Accepted"]}):U(s.expires_at)?e.jsxs("span",{className:"inline-flex items-center text-red-600",children:[e.jsx(S,{className:"h-4 w-4 mr-1"}),"Expired"]}):e.jsxs("span",{className:"inline-flex items-center text-yellow-600",children:[e.jsx(S,{className:"h-4 w-4 mr-1"}),"Pending"]})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:b(s.created_at)}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:b(s.expires_at)}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-right text-sm font-medium",children:!s.accepted_at&&e.jsxs("button",{onClick:()=>R(s.id),className:"text-red-600 hover:text-red-900 inline-flex items-center",children:[e.jsx(T,{className:"h-4 w-4 mr-1"}),"Revoke"]})})]},s.id))})]})})]})]})};export{W as default};
