import{b as j,a as w,R as n,j as e,s as g,c as v,r as S,A as C,L as E}from"./index-JDxZcwZg.js";import{C as y}from"./circle-alert-B391DCOR.js";import{S as A}from"./school-Mh_A7BXm.js";import{G as D}from"./globe-DY5WextA.js";import{B as F}from"./book-open-B2jTp5xz.js";import"./createLucideIcon-YQMw5vR1.js";const O=()=>{const a=j(),{user:r,loadUserSchools:d}=w(),[t,m]=n.useState({name:"",website:""}),[o,b]=n.useState(!1),[h,l]=n.useState(""),[f,x]=n.useState("");n.useEffect(()=>{r||a("/login",{state:{message:"Please log in to create a school"}})},[r,a]);const p=u=>{const{name:s,value:i}=u.target;m(c=>({...c,[s]:i})),h&&l("")},N=async u=>{if(u.preventDefault(),!r){l("You must be logged in to create a school");return}if(!t.name.trim()){l("School name is required");return}b(!0),l(""),x("Creating your school...");try{const{data:s,error:i}=await g.from("schools").insert([{name:t.name.trim(),website:t.website.trim()||null}]).select().single();if(i)throw console.error("❌ School creation error:",i),new Error(`Failed to create school: ${i.message}`);if(!s||!s.id)throw console.error("❌ No school data returned"),new Error("School was created but no ID was returned");console.log("✅ School created successfully with ID:",s.id),x("Setting you as school administrator...");const{error:c}=await g.from("school_members").insert([{school_id:s.id,user_id:r.id,role:"admin"}]);if(c)throw console.error("❌ School membership error:",c),await g.from("schools").delete().eq("id",s.id),new Error(`Failed to associate you with the school: ${c.message}`);console.log("✅ User added as school admin"),x("School created successfully!"),await d(),setTimeout(()=>{a(`/${s.id}/dashboard`,{state:{message:"School created successfully! Welcome to your dashboard."}})},1e3)}catch(s){console.error("❌ School creation error:",s),l(s.message||"Failed to create school. Please try again."),x("")}finally{b(!1)}};return e.jsxs("div",{className:"bg-white py-8 px-4 shadow sm:rounded-lg sm:px-10",children:[h&&e.jsx("div",{className:"mb-6 p-4 bg-red-50 border border-red-200 rounded-lg",children:e.jsxs("div",{className:"flex",children:[e.jsx(y,{className:"h-5 w-5 text-red-400 mr-2"}),e.jsx("p",{className:"text-sm font-medium text-red-800",children:h})]})}),f&&e.jsx("div",{className:"mb-6 p-4 bg-blue-50 border border-blue-200 rounded-lg",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"mr-3",children:e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-t-2 border-b-2 border-blue-600"})}),e.jsx("p",{className:"text-sm font-medium text-blue-800",children:f})]})}),e.jsxs("form",{className:"space-y-6",onSubmit:N,children:[e.jsxs("div",{children:[e.jsxs("label",{htmlFor:"name",className:"flex items-center text-sm font-medium text-gray-700",children:[e.jsx(A,{className:"h-4 w-4 mr-1"}),"School Name"]}),e.jsx("div",{className:"mt-1",children:e.jsx("input",{id:"name",name:"name",type:"text",required:!0,value:t.name,onChange:p,disabled:o,className:"block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm disabled:bg-gray-100 disabled:cursor-not-allowed",placeholder:"Enter your school's name"})})]}),e.jsxs("div",{children:[e.jsxs("label",{htmlFor:"website",className:"flex items-center text-sm font-medium text-gray-700",children:[e.jsx(D,{className:"h-4 w-4 mr-1"}),"School Website (Optional)"]}),e.jsx("div",{className:"mt-1",children:e.jsx("input",{id:"website",name:"website",type:"url",value:t.website,onChange:p,disabled:o,placeholder:"https://",className:"block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm disabled:bg-gray-100 disabled:cursor-not-allowed"})})]}),e.jsx("div",{children:e.jsx("button",{type:"submit",disabled:o,className:"w-full flex justify-center py-2 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 disabled:bg-indigo-400",children:o?e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-5 w-5 border-t-2 border-b-2 border-white mr-2"}),"Creating School..."]}):"Create School"})})]})]})},$=()=>{var o;const a=v(),r=j(),d=(o=a.state)==null?void 0:o.message,{isAdmin:t,user:m}=w();return S.useEffect(()=>{m&&!t()&&r(C.SCHOOLS,{state:{message:"Only administrators can create schools. Please contact your administrator."}})},[t,m,r]),t()?e.jsxs("div",{className:"min-h-screen bg-gray-50 flex flex-col justify-center py-12 sm:px-6 lg:px-8",children:[e.jsxs("div",{className:"sm:mx-auto sm:w-full sm:max-w-md",children:[e.jsx("div",{className:"flex justify-center",children:e.jsx(F,{className:"h-12 w-12 text-indigo-600"})}),e.jsx("h2",{className:"mt-6 text-center text-3xl font-extrabold text-gray-900",children:"Create Your School"}),e.jsx("p",{className:"mt-2 text-center text-sm text-gray-600",children:"Set up your school to start managing its voice"})]}),e.jsxs("div",{className:"mt-8 sm:mx-auto sm:w-full sm:max-w-md",children:[d&&e.jsx("div",{className:"mb-6 mx-4 p-4 sm:mx-0 bg-green-50 border border-green-200 rounded-lg",children:e.jsx("p",{className:"text-sm font-medium text-green-800",children:d})}),e.jsx(O,{}),e.jsx("div",{className:"mt-6 text-center",children:e.jsxs("span",{className:"text-sm text-gray-600",children:["Already have a school?"," ",e.jsx(E,{to:"/schools",className:"font-medium text-indigo-600 hover:text-indigo-500",children:"View your schools"})]})})]})]}):e.jsx("div",{className:"min-h-screen bg-gray-50 flex flex-col justify-center py-12 sm:px-6 lg:px-8",children:e.jsxs("div",{className:"sm:mx-auto sm:w-full sm:max-w-md",children:[e.jsx("div",{className:"flex justify-center",children:e.jsx(y,{className:"h-12 w-12 text-red-600"})}),e.jsx("h2",{className:"mt-6 text-center text-3xl font-extrabold text-gray-900",children:"Access Denied"}),e.jsx("p",{className:"mt-2 text-center text-sm text-gray-600",children:"Only administrators can create schools"})]})})};export{$ as default};
